# 技术假设

## 仓库结构：Monorepo

采用 pnpm workspace 管理的 Monorepo 结构，这与现有 FactoryOS 架构保持一致。这种结构便于包管理和代码共享，支持独立开发和部署。

## 服务架构

采用 **Monorepo 内的微服务架构**。前端保持单体应用架构，后端服务采用微服务设计，通过 API 网关统一管理。AI 功能通过 Dify iframe 集成，数据集成通过独立的服务模块实现。

## 测试要求：完整测试金字塔

实施 **单元测试 + 集成测试 + E2E 测试** 的完整测试策略。单元测试覆盖核心业务逻辑，集成测试验证服务间交互，E2E 测试确保用户流程正常工作。

## 额外技术假设和请求

### 前端技术栈

- **框架**：继续使用 Vue 3.5+ 和 TypeScript 5.8+，与现有技术栈保持一致
- **UI 组件库**：继续使用 Ant Design Vue 4.2+，确保界面一致性
- **状态管理**：使用 Pinia 3.0+ 进行状态管理
- **构建工具**：继续使用 Vite 7.1+ 进行开发和构建
- **图表库**：集成 ECharts 或 Apache ECharts 进行数据可视化
- **AI 通信**：使用 PostMessage API 与 Dify iframe 进行安全通信

### 后端技术栈

- **API 服务**：基于现有 Nitro Mock 服务扩展，或考虑 Node.js + Express/Fastify
- **数据库**：支持多种数据库（MySQL、PostgreSQL、SQL Server），使用 Prisma 或 TypeORM 进行数据访问
- **缓存**：使用 Redis 进行会话管理和数据缓存
- **消息队列**：使用 Redis 或 Bull Queue 处理异步任务
- **文件存储**：支持本地存储和云存储（AWS S3、阿里云 OSS）

### AI 集成技术

- **Dify 平台**：通过 iframe 嵌入，使用 PostMessage API 进行通信
- **数据处理**：实现数据清洗和验证机制，防止 AI 生成错误信息
- **模型选择**：支持多种 AI 模型，可根据业务需求选择合适的模型

### 安全和认证

- **认证机制**：基于 JWT 的认证系统，支持 Token 刷新
- **权限控制**：实现 RBAC + ABAC 混合权限模型
- **数据加密**：敏感数据使用 AES-256 加密存储
- **API 安全**：实施 API 限流、参数验证和 SQL 注入防护

### 部署和运维

- **容器化**：使用 Docker 进行应用容器化
- **CI/CD**：使用 GitHub Actions 或 GitLab CI 进行自动化部署
- **监控**：集成应用性能监控（APM）和错误追踪
- **日志**：结构化日志记录，支持日志聚合和分析
